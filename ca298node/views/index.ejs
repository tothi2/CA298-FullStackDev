<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
    <table id ="product-table">
      <thead>
        <tr>
          <td>Name</td>
          <td>Description</td>
          <td>Price</td>
        </tr>
      </thead>
    </table>

    <form id="login-form" method="POST", action=".">
      <label for="username">Username</label>
      <input id="form-username" name="username" type="text" placeholder="Your Username">
      <label for="password">Password</label>
      <input type="password" name="password" id="form-password" placeholder="Your Password">
      <input type="submit" value="login">
    </form>

    <script>
      fetch("http://localhost:8000/api/products/?format=json") // make a request to this endpoint
      .then(response => response.json()) // with our response, get the json data returned
      .then(data =>{ 
        console.log(data)
        data.forEach(element => {
          let table = document.getElementById("product-table")
          let newRow = document.createElement("tr")
          table.appendChild(newRow)
          let name = document.createElement("td")
          name.innerHTML = element['name']
          newRow.appendChild(name)
          let desc = document.createElement("td")
          desc.innerHTML = element['description']
          newRow.appendChild(desc)
          let price = document.createElement("td")
          price.innerHTML = element['price']
          newRow.appendChild(price)

          let loginform = document.getElementById("login-form")
          loginform.addEventListener("submit", (event)=>{
            event.preventDefault();
            let user=document.getElementById("form-username").value
            let pass=document.getElementById("form-password").value
            fetch("http://127.0.0.1:8000/token/", {
              method:'POST',
              headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              },
              body:JSON.stringify( {username:user, password:pass})
            }).then(response => response.json()).then(data => console.log(data))
          }, true)


        });
        
        
      }); // log the json data
    </script>     
  </body>
</html>
